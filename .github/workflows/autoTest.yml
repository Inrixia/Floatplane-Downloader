---
name: "Code Checks"

on:
 pull_request:
  types: ["opened", "edited", "reopened", "synchronize", "ready_for_review", "review_requested"]
 push:
  branches:
   - "dev"

jobs:
 ESM:
  name: "Compile & Sanity Check ESM"
  runs-on: "ubuntu-latest"

  steps:
   - uses: actions/checkout@v4
   - name: Install pnpm 游닌
     uses: pnpm/action-setup@v4

   - name: Install Node.js 游닌
     uses: actions/setup-node@v4
     with:
      cache: "pnpm"

   - name: Install dependencies 游닌
     run: pnpm install

   - name: "Compile & Sanity Test"
     run: pnpm run test-esm

 Binary:
  strategy:
   matrix:
    runs-on: [ubuntu-latest, windows-latest]
  name: "Build & Sanity Check ${{ matrix.runs-on }} Binary"
  runs-on: ${{ matrix.runs-on }}

  steps:
   - uses: actions/checkout@v4
   - name: Install pnpm 游닌
     uses: pnpm/action-setup@v4

   - name: Install Node.js 游닌
     uses: actions/setup-node@v4
     with:
      cache: "pnpm"

   - name: Install dependencies 游닌
     run: pnpm install

   - name: "Build & Sanity Test"
     run: pnpm run test-${{ matrix.runs-on }}

 eslint:
  name: eslint
  runs-on: ubuntu-latest
  steps:
   - uses: actions/checkout@v4
   - uses: reviewdog/action-eslint@v1
     with:
      reporter: github-check
      eslint_flags: "src/"
      github_token: ${{ secrets.GITHUB_TOKEN }}
